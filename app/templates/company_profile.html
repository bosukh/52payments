<!DOCTYPE html>
<!-- extend base layout -->
{% extends "base.html" %}
{% block content %}

<div class="company-profile-container">
  <div class="company-profile-top-row">
    <img id="company-profile-logo" src="{{ url_for('img', company_profile_name=company.company_profile_name) }}" alt="company_logo">
    <a href="{{company.landing_page}}" target = '_blank'>
      <button id='company-apply-button' class= 'button' type="button" name="button">Apply</button>
    </a>
    {% if current_user.is_authenticated and current_user%}
    <a href="javascript:show_review_box()">
      <button onclick='on_write_review()' id='company-review-button' class= 'button' type="button" name="button">Write a Review</button>
    </a>
    {% else %}
    <a href="javascript:alert_login_required()">
      <button id='company-review-button' class= 'button' type="button" name="button">Write a Review</button>
    </a>
    {% endif %}
  </div>

  <div class="company-left-col">
    <div class="company-profile-basic-box">
      {% if company.title %}
        Name: {{company.title}}<br>
      {% endif %}
      {% if company.website %}
        Website: {{company.website}}<br>
      {% endif %}
      {% if company.phones %}
        {% for phone in company.phones %}
          {{ phone }} <br>
        {% endfor %}
      {% endif %}
    </div>
    <div class="company-profile-basic-box">
      Overall User Rating: <br>
      {% for i in range(company.rounded_rating)%}
      <span class='rating-star'>★</span>
      {% endfor %}
      {% for i in range(5-company.rounded_rating)%}
      <span class='rating-star'>☆</span>
      {% endfor %}
      {{bjs().round(company.avg_rating)}} ({{company.num_ratings}}) <br>
      √ Verified With 52Payments <br>
    </div>
    <div class="company-profile-basic-box">
      {% if company.pricing_range %}
        Pricing Range: {{company.pricing_range[0]}}% ~ {{company.pricing_range[1]}}%<br>
      {% endif %}
      {% if company.rate_range and company.per_transaction_range %}
        Detailed Pricing Range: <br>{{company.rate_range[0]}}% + {{company.per_transaction_range[0]}}$
                                ~ {{company.rate_range[1]}}% + {{company.per_transaction_range[1]}}$<br>
      {% endif %}
    </div>

    {% if company.pricing_method %}
    <div class="company-profile-basic-box">
      Pricing Method: <br>
      {% for method in company.pricing_method%}
      &nbsp;&nbsp;- {{method}} <br>
      {% endfor %}
    </div>
    {% endif %}

    {% if company.provided_srvs %}
    <div class="company-profile-basic-box">
      Provided Services: <br>
      {% for srvs in company.provided_srvs%}
      &nbsp;&nbsp;- {{srvs}} <br>
      {% endfor %}
    </div>
    {% endif %}

    {% if company.complementary_srvs %}
    <div class="company-profile-basic-box">
      Complementary Services: <br>
      {% for srvs in company.complementary_srvs%}
      &nbsp;&nbsp;- {{srvs}} <br>
      {% endfor %}
    </div>
    {% endif %}

    {% if company.equipment %}
    <div class="company-profile-basic-box">
      Equipment <br>
      {% for equip in company.equipment%}
      &nbsp;&nbsp;- {{equip}} <br>
      {% endfor %}
    </div>
    {% endif %}
  </div>
  <div id='company-right-col' class="company-right-col">
    {% include 'write_review.html' %}
    <div class="company-profile-basic-box">
      {% if company.title %}
        <h4>{{ company.title }}</h4>
      {% endif %}
      {{company.full_description}}
    </div>
  </div>
  <div id='review-box' class="company-right-col">
    <div class="company-profile-basic-box">
      {% if reviews %}
        {% include 'review.html' %}
      {% else %}
        <p>
          Threre's no review for the company yet.
        </p>
      {% endif %}
    </div>
    <div id = 'page-moves'>
      <a id ='prev' class='page-move' style="display:none;" href="#">Prev</a>
      <a id ='next' class='page-move' style="display:none;" href="#">Next</a>
    </div>
  </div>
</div>
<script type="text/javascript">

var on_write_review = function() {
  document.getElementById('title').style = 'width:calc(100% - 8px);' ;
  document.getElementById('content').style = 'width:100%;';
  var width_ = document.getElementById('write-review-box').offsetWidth;
  document.getElementById('content').style = 'width: 100%; height:200px;'
  disable_btn('review-submit-button');
}
</script>

<script type="text/javascript">
  var page = 0;
  var next_page, prev_page;

  var reviews = document.getElementsByClassName('review');

  var hide_all = function(reviews){
    for (var i = 0; i < reviews.length; i++){
      reviews[i].style.display = 'none';
    };
  }
  var create_page_moves = function(page, reviews){
    next_page = page+1;
    prev_page = page-1;
    var next = document.getElementById('next');
    next.setAttribute('href', 'javascript:display_current_page(next_page, reviews)');
    next.style.display = 'none';
    var prev = document.getElementById('prev');
    prev.setAttribute('href', 'javascript:display_current_page(prev_page, reviews)');
    prev.style.display = 'none';
    if (page != 0){
      prev.style.display = 'inline-block';
    };
    if (reviews.length/3 > page+1){
      next.style.display = 'inline-block';
    };
  }
  var display_current_page = function(page, reviews){
    hide_all(reviews);
    for (var i = page*3; i < (page+1)*3 && i < reviews.length; i++){
      reviews[i].style.display = 'block';
    }
    create_page_moves(page, reviews);
  }
  display_current_page(page, reviews);
</script>

<script type="text/javascript">
var show_review_box = function(){
  document.getElementById('write-review-box').style = 'display:block;';
  check_all();
}
</script>

{% endblock %}
